var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Tabs=function(){function e(t){var i=this;classCallCheck(this,e),this.activeTab={tab:null,page:null},this.pages={},this.namespace=t;var n=[].slice.call(document.getElementById(this.namespace+"Tabs").getElementsByTagName("a"));this.pages=[].slice.call(document.getElementById(this.namespace+"Pages").children).reduce(function(e,t){return e[t.dataset.seoTab]=t,e},{}),this.setActiveTab(n[0]),n.forEach(function(e){e.addEventListener("click",function(t){t.preventDefault(),i.setActiveTab(e)})})}return createClass(e,[{key:"setActiveTab",value:function(e){var t=e.dataset.seoTab;this.activeTab.tab&&(this.activeTab.tab.classList.remove("active"),this.activeTab.page.classList.remove("active")),this.activeTab={tab:e,page:this.pages[t]},this.activeTab.tab.classList.add("active"),this.activeTab.page.classList.add("active")}}]),e}();function createElement(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=document.createElement(e),r=!0,a=!1,s=void 0;try{for(var o,l=Object.entries(t)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value,d=slicedToArray(c,2),h=d[0],u=d[1];u&&((void 0===u?"undefined":_typeof(u))!==_typeof(function(){})?("style"===h&&(u=u.replace(/(?:\r\n|\r|\n|\t|\s+)/g," ").trim()),n.setAttribute(h,u)):"ref"===h?u(n):n.addEventListener(h,u))}}catch(e){a=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw s}}return Array.isArray(i)||(i=[i]),i.map(function(e){if(e)try{n.appendChild(e)}catch(t){n.appendChild(document.createTextNode(e))}}),n}var TextStatistics=function(){function e(t){classCallCheck(this,e),this.text=t?e.cleanText(t):t}return createClass(e,[{key:"fleschKincaidReadingEase",value:function(){return Math.round(10*(206.835-1.015*this.averageWordsPerSentence()-84.6*this.averageSyllablesPerWord()))/10}},{key:"fleschKincaidGradeLevel",value:function(){return Math.round(10*(.39*this.averageWordsPerSentence()+11.8*this.averageSyllablesPerWord()-15.59))/10}},{key:"gunningFogScore",value:function(){return Math.round(.4*(this.averageWordsPerSentence()+this.percentageWordsWithThreeSyllables(!1))*10)/10}},{key:"colemanLiauIndex",value:function(){return Math.round(10*(this.letterCount()/this.wordCount()*5.89-this.sentenceCount()/this.wordCount()*.3-15.8))/10}},{key:"smogIndex",value:function(){return Math.round(1.043*Math.sqrt(this.wordsWithThreeSyllables()*(30/this.sentenceCount())+3.1291)*10)/10}},{key:"automatedReadabilityIndex",value:function(){return Math.round(10*(this.letterCount()/this.wordCount()*4.71+this.wordCount()/this.sentenceCount()*.5-21.43))/10}},{key:"textLength",value:function(){return this.text.length}},{key:"letterCount",value:function(){return this.text.replace(/[^a-z]+/gi,"").length}},{key:"sentenceCount",value:function(){return this.text.replace(/[^.!?]/g,"").length||1}},{key:"wordCount",value:function(){return this.words().length||1}},{key:"words",value:function(){return this._words?this._words:(this._words=this.text.split(/[^a-z0-9']+/i),this._words)}},{key:"averageWordsPerSentence",value:function(){return this.wordCount()/this.sentenceCount()}},{key:"averageSyllablesPerWord",value:function(){var t=0,i=this.wordCount();return this.text.split(/\s+/).forEach(function(i){t+=e.syllableCount(i)}),(t||1)/(i||1)}},{key:"wordsWithThreeSyllables",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=0;return t=!1!==t,this.text.split(/\s+/).forEach(function(n){n.match(/^[A-Z]/)&&!t||e.syllableCount(n)>2&&i++}),i}},{key:"percentageWordsWithThreeSyllables",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.wordsWithThreeSyllables(e)/this.wordCount()*100}}],[{key:"cleanText",value:function(e){return["li","p","h1","h2","h3","h4","h5","h6","dd"].forEach(function(t){e.replace("</"+t+">",".")}),e=e.replace(/<[^>]+>/g,"").replace(/[,:;()-]/g," ").replace(/[.!?]/g,".").replace(/^\s+/g,"").replace(/[ ]*(\n|\r\n|\r)[ ]*/g," ").replace(/([.])[. ]+/g,".").replace(/[ ]*([.])/g,". ").replace(/\s+/g," ").replace(/\s+$/g,"").replace(/'/g,""),e+="."}},{key:"syllableCount",value:function(e){var t=0,i=0;e=e.toLowerCase().replace(/[^a-z]/g,"");var n={simile:3,forever:3,shoreline:2};if(n.hasOwnProperty(e))return n[e];[/^un/,/^fore/,/ly$/,/less$/,/ful$/,/ers?$/,/ings?$/].forEach(function(t){e.match(t)&&(e=e.replace(t,""),i++)});var r=e.split(/[^aeiouy]+/gi).filter(function(e){return!!e.replace(/\s+/gi,"").length}).length;return t=r+i,[/cial/,/tia/,/cius/,/cious/,/giu/,/ion/,/iou/,/sia$/,/[^aeiuoyt]{2,}ed$/,/.ely$/,/[cg]h?e[rsd]?$/,/rved?$/,/[aeiouy][dt]es?$/,/[aeiouy][^aeiouydt]e[rsd]?$/,/^[dr]e[aeiou][^aeiou]+$/,/[aeiouy]rse$/].forEach(function(i){e.match(i)&&t--}),[/ia/,/riet/,/dien/,/iu/,/io/,/ii/,/[aeiouym]bl$/,/[aeiou]{3}/,/^mc/,/ism$/,/([^aeiouy])\1l$/,/[^l]lien/,/^coa[dglx]./,/[^gq]ua[^auieo]/,/dnt$/,/uity$/,/ie(r|st)$/].forEach(function(i){e.match(i)&&t++}),t||1}}]),e}();function fail(e){Craft.cp.displayError("<strong>SEO:</strong> "+e),window.console&&console.error.apply(console,["%cSEO: %c "+e,"font-weight: bold;","font-weight: normal;"])}function debounce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=void 0;return 0===t?function(){e.apply(this,arguments)}:function(){var r=this,a=arguments;"SyntheticEvent"===a[0].constructor.name&&a[0].persist();var s=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||e.apply(r,a)},t),s&&e.apply(r,a)}}function capitalize(e){return e[0].toUpperCase()+e.slice(1)}function isExternalUrl(e){var t=function(e){var t=/https?:\/\/((?:[\w\d-]+\.)+[\w\d]{2,})/i.exec(e);return null!==t&&t[1]};return t(location.href)===t(e)}function countInArray(e,t){var i=0,n=e.length;if(Array.isArray(t))for(var r=e.length,a=t.length;n--;){for(var s=a,o=0;s--&&n+s<r;)e[n+s].toLowerCase()===t[s]&&o++;o===a&&i++}else for(;n--;)e[n].toLowerCase()===t&&i++;return i}function createRating(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=capitalize(e);return createElement(t,{class:"seo--light "+e,title:i},i)}var EntryMarkup=function(){function e(){classCallCheck(this,e),this.frame=null,this.postData=null,this.clean()}return createClass(e,[{key:"update",value:function(){var e=this;return new Promise(function(t,i){var n=Garnish.getPostData(document.getElementById("main-form"));e.postData&&Craft.compare(n,e.postData)?t(e.frame.contentWindow.document.body):(e.postData=n,$.ajax({url:Craft.livePreview.previewUrl,method:"POST",data:$.extend({},n,Craft.livePreview.basePostData),xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){n=(n=n.replace(/<script([^'"]|"(\\.|[^"\\])*"|'(\\.|[^'\\])*')*?<\/script>/g,"")).replace(/<style([^'"]|"(\\.|[^"\\])*"|'(\\.|[^'\\])*')*?<\/style>/g,""),e.frame.contentWindow.document.open(),e.frame.contentWindow.document.write(n),e.frame.contentWindow.document.close(),e.frame.contentWindow.document.body?t(e.frame.contentWindow.document.body):(fail("Failed to parse entry preview"),i())},error:function(){fail("Failed to retrieve entry preview"),i()}}))})}},{key:"clean",value:function(){this.frame&&document.body.removeChild(this.frame),this.frame=createElement("iframe",{frameborder:"0",style:"\n\t\t\t\twidth: 0;\n\t\t\t\theight: 0;\n\t\t\t"}),document.body.appendChild(this.frame)}}]),e}(),EntryMarkup$1=new EntryMarkup,SEO_RATING={NONE:"neutral",GOOD:"good",AVERAGE:"average",POOR:"poor"},SEO_RATING_LABEL={neutral:"Not yet rated",good:"Looks good",average:"Room for improvement",poor:"Needs work"},SEO_REASONS={noContent:"You don't have any content, adding some would be a good start!",titleLengthFailMin:"The title contains {l} characters which is less than the recommended minimum of 40 characters.",titleLengthFailMax:"The title contains {l} characters which is greater than the recommended maximum of 60 characters.",titleLengthSuccess:"The title is between the recommended minimum and maximum length.",titleKeywordFail:"The title does not contain the keyword. Try adding it near the beginning of the title.",titleKeywordSuccess:"The title contains the keyword near the beginning.",titleKeywordPosFail:"The title contains the keyword, but not near the beginning. Try to move it closer to the start of the title.",slugFail:"The URL does not contain the keyword. Try adding it to the slug.",slugSuccess:"The URL contains the keyword.",descFail:"The description does not contain the keyword. Try adding it near the beginning of the description.",descSuccess:"The description contains the keyword.",wordCountFail:"Your text contains {l} words, this is less than the recommended 300 word minimum.",wordCountSuccess:"Your text contains {l} words, this is more than the recommended 300 word minimum.",firstParagraphFail:"The keyword does not appear in the first paragraph of your text. Try adding it.",firstParagraphSuccess:"The keyword appears in the first paragraph of your text.",imagesFail:"Less than half of the images have alt tags containing the keyword, try adding it to more images.",imagesOk:"Half or more of the images have alt tags containing the keyword. To improve this, try adding keywords to all the images alt tags.",imagesSuccess:"All of the images have alt tags containing the keyword.",linksFail:"The page does not contain any outgoing links. Try adding some.",linksSuccess:"The page contains outgoing links.",headingsFail:"The page does not contain any headings that contain the keyword. Try adding some with the keyword.",headingsOk:"The page contains some lower importance headings that contain the keyword. Try adding the keyword to some h2's.",headingsSuccess:"The page contains higher importance headings with the keyword.",densityFail:"The keyword does not appear in the text. It is important to include it in your content.",densityFailUnder:"The keyword density is {d}%, which is well under the advised 2.5%. Try increasing the number of times the keyword is used.",densityOk:"The keyword density is {d}%, which is over the advised 2.5%. The keyword appears {c} times.",densitySuccess:"The keyword density is {d}%, which is near the advised 2.5%.",fleschFail:"The Flesch Reading ease score is {l} which is considered best for university graduates. Try reducing your sentence length to improve readability.",fleschOk:"The Flesch Reading ease score is {l} which is average, and considered easily readable by most users.",fleschSuccess:"The Flesch Reading ease score is {l} meaning your content is readable by all ages."},KeywordChecklist=function(){function e(t,i){classCallCheck(this,e),this.keyword=null,this.keywordLower=null,this.ratings=[],this.ratingOccurrence={},this.content=null,this.text=null,this.stats=null,this.renderChecklistItem=function(e){var t=e.rating,i=e.reason;return createElement("li",{},[createRating(t),createElement("p",{},i)])},this.namespace=t,this.SEO=i,this.bar=document.getElementById(t+"KeywordBar"),this.checklist=document.getElementById(t+"KeywordChecklist")}return createClass(e,[{key:"calculate",value:function(t,i){var n=this;EntryMarkup$1.update().then(function(r){if(n.ratings=[],n.keyword=t,n.keywordLower=t.toLowerCase(),n.text=r.textContent.replace(/(\r\n|\r|\n|\t+)/gim,""),""===n.text.trim())return n.addRating(SEO_RATING.POOR,SEO_REASONS.noContent),n.renderChecklist(),void i(SEO_RATING.POOR);n.content=r,n.stats=new TextStatistics(n.text),Object.getOwnPropertyNames(e.prototype).filter(function(e){return e.indexOf("judge")>-1}).forEach(function(e){n[e]()}),n.ratingOccurrence={},n.ratings.sort(function(t,i){return e.ratingValue(i.rating)-e.ratingValue(t.rating)}).forEach(function(e){var t=e.rating;n.ratingOccurrence.hasOwnProperty(t)||(n.ratingOccurrence[t]=0),n.ratingOccurrence[t]++});var a=Object.keys(n.ratingOccurrence).reduce(function(e,t){return n.ratingOccurrence[e]>n.ratingOccurrence[t]?e:t});n.renderChecklist(),i(a)}).catch(function(e){console.error(e)})}},{key:"clear",value:function(e){for(var t=this.bar.children.length;t--;){this.bar.children[t].style.transform=""}for(;this.checklist.firstElementChild;)this.checklist.removeChild(this.checklist.firstElementChild);var i=document.createElement("li");i.style.textAlign="center",i.textContent="No keyword selected",this.checklist.appendChild(i),e()}},{key:"renderChecklist",value:function(){for(var e=this,t=this.ratings.length,i=0,n=0;n<this.bar.children.length;n++){var r=this.bar.children[n],a=r.className;r.style.transform="translateX("+i+"%)",this.ratingOccurrence.hasOwnProperty(a)&&(i+=this.ratingOccurrence[a]/t*100)}for(;this.checklist.firstElementChild;)this.checklist.removeChild(this.checklist.firstElementChild);this.ratings.forEach(function(t){e.checklist.appendChild(e.renderChecklistItem(t))})}},{key:"judgeTitleLength",value:function(){var e=this.SEO.snippetFields.title.value.length;this.addRating(e<40||e>60?SEO_RATING.POOR:SEO_RATING.GOOD,e<40?SEO_REASONS.titleLengthFailMin.replace("{l}",e):e>60?SEO_REASONS.titleLengthFailMax.replace("{l}",e):SEO_REASONS.titleLengthSuccess)}},{key:"judgeTitleKeyword",value:function(){var e=this.SEO.snippetFields.title.value,t=e.toLowerCase().indexOf(this.keywordLower);if(t>-1)return t<=.3*e.length?void this.addRating(SEO_RATING.GOOD,SEO_REASONS.titleKeywordSuccess):void this.addRating(SEO_RATING.AVERAGE,SEO_REASONS.titleKeywordPosFail);this.addRating(SEO_RATING.POOR,SEO_REASONS.titleKeywordFail)}},{key:"judgeSlug",value:function(){if(this.SEO.snippetFields.slug){var e=this.SEO.snippetFields.slug.textContent.toLowerCase(),t=this.keywordLower.replace(/[^a-zA-Z0-9-_]/g,"");e.indexOf(t)>-1?this.addRating(SEO_RATING.GOOD,SEO_REASONS.slugSuccess):this.addRating(SEO_RATING.POOR,SEO_REASONS.slugFail)}}},{key:"judgeDesc",value:function(){this.SEO.snippetFields.desc.value.toLowerCase().indexOf(this.keywordLower)>-1?this.addRating(SEO_RATING.GOOD,SEO_REASONS.descSuccess):this.addRating(SEO_RATING.POOR,SEO_REASONS.descFail)}},{key:"judgeWordCount",value:function(){var e=this.stats.wordCount();e>300?this.addRating(SEO_RATING.GOOD,SEO_REASONS.wordCountSuccess.replace("{l}",e)):this.addRating(SEO_RATING.POOR,SEO_REASONS.wordCountFail.replace("{l}",e))}},{key:"judgeFirstParagraph",value:function(){var e=this.content.querySelector("p");e&&e.textContent.toLowerCase().indexOf(this.keywordLower)>-1?this.addRating(SEO_RATING.GOOD,SEO_REASONS.firstParagraphSuccess):this.addRating(SEO_RATING.POOR,SEO_REASONS.firstParagraphFail)}},{key:"judgeImages",value:function(){var e=this.content.getElementsByTagName("img");if(e.length){for(var t=0,i=e.length;i--;){var n=e[i].getAttribute("alt");n&&n.toLowerCase().indexOf(this.keywordLower)>-1&&t++}t>=.8*e.length?this.addRating(SEO_RATING.GOOD,SEO_REASONS.imagesSuccess):t>=.5*e.length?this.addRating(SEO_RATING.AVERAGE,SEO_REASONS.imagesOk):this.addRating(SEO_RATING.POOR,SEO_REASONS.imagesFail)}}},{key:"judgeLinks",value:function(){var e=this.content.getElementsByTagName("a");if(e.length){for(var t=0;t<e.length;t++)if(isExternalUrl(e[t].href))return void this.addRating(SEO_RATING.GOOD,SEO_REASONS.linksSuccess);this.addRating(SEO_RATING.POOR,SEO_REASONS.linksFail)}}},{key:"judgeHeadings",value:function(){var e=this.content.querySelectorAll("h1, h2, h3, h4, h5, h6");if(e.length){for(var t=0,i=0,n=e.length;n--;){var r=e[n];-1!==r.textContent.toLowerCase().indexOf(this.keywordLower)&&(["h1","h2"].indexOf(r.nodeName.toLowerCase())>-1?t++:i++)}t>0?this.addRating(SEO_RATING.GOOD,SEO_REASONS.headingsSuccess):i>0?this.addRating(SEO_RATING.AVERAGE,SEO_REASONS.headingsOk):this.addRating(SEO_RATING.POOR,SEO_REASONS.headingsFail)}}},{key:"judgeDensity",value:function(){var e=this.stats.words(),t=~~this.keywordLower.indexOf(" ")?this.keywordLower.split(" "):this.keywordLower,i=countInArray(e,t),n=Array.isArray(t)?t.length:0,r=e.length-n,a=+(100+(i-r)/r*100).toFixed(2);a<1?this.addRating(SEO_RATING.POOR,SEO_REASONS.densityFailUnder.replace("{d}",a)):a<=2.5?this.addRating(SEO_RATING.GOOD,SEO_REASONS.densitySuccess.replace("{d}",a)):a>2.5?this.addRating(SEO_RATING.AVERAGE,SEO_REASONS.densityOk.replace("{d}",a).replace("{c}",i)):this.addRating(SEO_RATING.POOR,SEO_REASONS.densityFail)}},{key:"judgeFleschEase",value:function(){var e=this.stats.fleschKincaidReadingEase();e>=80?this.addRating(SEO_RATING.GOOD,SEO_REASONS.fleschSuccess.replace("{l}",e)):e>=60?this.addRating(SEO_RATING.AVERAGE,SEO_REASONS.fleschOk.replace("{l}",e)):this.addRating(SEO_RATING.POOR,SEO_REASONS.fleschFail.replace("{l}",e))}},{key:"addRating",value:function(e,t){this.ratings.push({rating:e,reason:t})}}],[{key:"ratingValue",value:function(e){switch(e){case SEO_RATING.POOR:return-1;case SEO_RATING.AVERAGE:return 1;case SEO_RATING.GOOD:return 2;default:return 0}}}]),e}(),FocusKeywords=function(){function e(t,i){var n=this;classCallCheck(this,e),this.activeKeywordIndex=null,this.recalculateKeyword=function(){if(n.stopObserving(),null!==n.activeKeywordIndex){var e=n.keywords[n.activeKeywordIndex];n.keywordsChecklist.calculate(e.keyword,n.onNewRating.bind(n,e.index))}setTimeout(function(){n.startObserving()},1)},this.onKeywordsChange=function(){var e={};n.keywordsField.value=JSON.stringify(n.keywords.map(function(t){var i=t.keyword,n=t.rating;return e.hasOwnProperty(n)||(e[n]=0),e[n]++,{keyword:i,rating:n}})),Object.keys(e).length?n.scoreField.value=Object.keys(e).reduce(function(t,i){return e[t]>e[i]?t:i}):n.scoreField.value=""},this.onNewRating=function(e,t){var i=n.keywords[e];if(i){i.rating=t;var r=n.getKeywordElementAtIndex(e);for(r.removeChild(r.firstElementChild),r.insertBefore(createRating(t,"span"),r.firstChild),n.keywordElem.textContent=i.keyword;n.ratingElem.firstChild;)n.ratingElem.removeChild(n.ratingElem.firstChild);n.ratingElem.appendChild(createRating(t)),n.ratingElem.appendChild(document.createTextNode(SEO_RATING_LABEL[t])),n.onKeywordsChange()}else n.onEmptyRating()},this.onEmptyRating=function(){for(n.keywordElem.innerHTML="<em>No keyword selected</em>";n.ratingElem.firstChild;)n.ratingElem.removeChild(n.ratingElem.firstChild);n.ratingElem.appendChild(createRating("neutral")),n.ratingElem.appendChild(document.createTextNode(SEO_RATING_LABEL.neutral))},this.onKeywordClick=function(e){e.preventDefault(),n.setActiveKeyword(e.target.dataset.index)},this.onKeywordRemoveClick=function(e){e.preventDefault(),e.stopPropagation();var t=0|e.target.parentNode.parentNode.dataset.index,i=n.getKeywordElementAtIndex(t);i.parentNode.removeChild(i),n.keywords.splice(t,1),n.keywords=n.keywords.map(function(e,t){return n.activeKeywordIndex===e.index&&(n.activeKeywordIndex=t),n.getKeywordElementAtIndex(t).setAttribute("data-index",t),_extends({},e,{index:t})}),n.activeKeywordIndex===t&&n.setActiveKeyword(0),n.onKeywordsChange()},this.onInputWrapClick=function(e){e.target===n.inputWrap&&n.input.focus()},this.onInputFocus=function(){n.inputWrap.classList.add("focused")},this.onInputBlur=function(e){n.inputWrap.classList.remove("focused"),""!==e.target.value.trim()&&n.onInputKeyDown({target:e.target,keyCode:13,preventDefault:function(){}})},this.onInputKeyDown=function(e){if(13===e.keyCode){e.preventDefault();var t=e.target.value.trim(),i=!1;if(t){for(var r=n.keywords.length;r--;){var a=n.keywords[r],s=a.keyword,o=a.index;if(t.toLowerCase()===s.toLowerCase()){i=!0,n.setActiveKeyword(o);break}}!i&&n.createKeyword(t),e.target.value=""}}},this.createKeyword=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"neutral",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null!==i?i:n.keywords.length,a=createElement("a",{href:"#",click:n.onKeywordClick,"data-index":String(r)},[createRating(t,"span"),e,createElement("object",{},createElement("a",{href:"#",title:"Remove",click:n.onKeywordRemoveClick},"Remove"))]);n.inputWrap.insertBefore(a,n.inputWrap.lastElementChild),null===i&&(n.keywords.push({keyword:e,rating:t,index:r}),n.setActiveKeyword(r),n.onKeywordsChange())},this.getKeywordElementAtIndex=function(e){return n.inputWrap.children[e]},this.namespace=t,this.SEO=i,this.keywordsChecklist=new KeywordChecklist(t,i),this.keywordsField=document.getElementById(t+"Keywords"),this.scoreField=document.getElementById(t+"Score"),this.keywordElem=document.getElementById(t+"Keyword"),this.ratingElem=document.getElementById(t+"Rating"),this.initInput(),this.initKeywords(),this.initWatcher()}return createClass(e,[{key:"initInput",value:function(){this.inputWrap=document.getElementById(this.namespace+"KeywordsInput"),this.input=this.inputWrap.lastElementChild,this.inputWrap.addEventListener("click",this.onInputWrapClick),this.input.addEventListener("focus",this.onInputFocus),this.input.addEventListener("blur",this.onInputBlur),this.input.addEventListener("keydown",this.onInputKeyDown)}},{key:"initKeywords",value:function(){var e=this;try{this.keywords=JSON.parse(this.keywordsField.value).map(function(t,i){return e.createKeyword(t.keyword,t.rating,i),_extends({},t,{index:i})})}catch(e){this.keywords=[]}this.keywords.length&&this.setActiveKeyword(0),this.onKeywordsChange()}},{key:"initWatcher",value:function(){this.mo=new MutationObserver(debounce(this.recalculateKeyword,500)),this.startObserving()}},{key:"startObserving",value:function(){if(this.mo){var e=this.keywordsField.form;null===e&&(e=Craft.livePreview.$editor[0]),this.mo.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}},{key:"stopObserving",value:function(){this.mo&&(this.mo.disconnect(),this.mo.takeRecords())}},{key:"setActiveKeyword",value:function(e){!this.keywords.length>e&&(this.activeKeywordIndex=null),this.activeKeywordIndex!==e&&(null!==this.activeKeywordIndex&&this.keywords.length>this.activeKeywordIndex&&this.getKeywordElementAtIndex(this.activeKeywordIndex).classList.remove("active"),this.keywords.length>e?(this.activeKeywordIndex=0|e,this.getKeywordElementAtIndex(this.activeKeywordIndex).classList.add("active"),this.recalculateKeyword()):this.keywordsChecklist.clear(this.onEmptyRating))}}]),e}(),Snippet=function(){function e(t,i){classCallCheck(this,e),this.namespace=t,this.SEO=i,this.titleField=document.getElementById(t+"Title"),this.slugField=document.getElementById(t+"Slug"),this.descField=document.getElementById(t+"Description"),this.SEO.snippetFields={title:this.titleField,slug:this.slugField,desc:this.descField},this.title(),this.slugField&&i.options.hasPreview&&this.slug(),this.desc()}return createClass(e,[{key:"title",value:function(){var e=this,t=document.getElementById("title");if(t&&this.titleField.classList.contains("clean")&&this.SEO.options.isNew||""===this.titleField.value.trim()){var i=this.titleField.value,n=function(){e.SEO.options.suffixAsPrefix?e.titleField.value=i+" "+t.value:e.titleField.value=t.value+" "+i};t.addEventListener("input",n,!1),this.titleField.addEventListener("input",function i(){e.titleField.classList.remove("clean"),t.removeEventListener("input",n,!1),e.titleField.removeEventListener("input",i,!1)},!1),n()}}},{key:"slug",value:function(){var e=this,t=document.getElementById("slug");if(t){var i=function(){e.slugField.textContent=t.value};t.addEventListener("input",i);var n=document.getElementById("title");n&&n.addEventListener("input",debounce(i,500)),i()}}},{key:"desc",value:function(){var e=this,t=function(){setTimeout(function(){e.descField.style.height="",e.descField.style.height=e.descField.scrollHeight+"px"},1)};if(this.descField.addEventListener("keydown",function(e){13===e.keyCode&&e.preventDefault()}),this.descField.addEventListener("input",function(){e.descField.value=e.descField.value.replace(/(\r\n|\r|\n)/gm," "),e.descField.value.length>313?e.descField.classList.add("invalid"):e.descField.classList.remove("invalid"),t()}),document.getElementById("tabs"))for(var i=document.querySelectorAll("#tabs a.tab"),n=0;n<i.length;n++)i[n].addEventListener("click",t);Craft.livePreview&&(Craft.livePreview.on("enter",t),Craft.livePreview.on("exit",t)),window.addEventListener("resize",t),setTimeout(function(){t()},15)}}]),e}(),Social=function(){function e(t,i){classCallCheck(this,e),this.onImageInputClick=function(e,t){t.preventDefault(),e.classList.contains("has-image")||t.target.classList.contains("remove")||Craft.createElementSelectorModal("craft\\elements\\Asset",{multiSelect:!1,criteria:{kind:["image"]},onSelect:function(t){var i=t[0];e.classList.add("has-image"),e.style.backgroundImage="url("+i.url+")",e.firstElementChild.value=i.id}})},this.onImageRemoveClick=function(e){e.classList.contains("has-image")&&(e.classList.remove("has-image"),e.style.backgroundImage="",e.firstElementChild.value="")},this.namespace=t,this.SEO=i,this.initImages(),this.initDesc()}return createClass(e,[{key:"initImages",value:function(){for(var e=document.querySelectorAll("a[data-seo-social-image='"+this.namespace+"']"),t=e.length;t--;){var i=e[t];i.addEventListener("click",this.onImageInputClick.bind(this,i)),i.querySelector(".remove").addEventListener("click",this.onImageRemoveClick.bind(this,i))}}},{key:"initDesc",value:function(){for(var e=document.querySelectorAll("textarea[data-seo-social-desc='"+this.namespace+"']"),t=e.length,i=function(){var i=e[t];i.addEventListener("input",function(){i.value=i.value.replace(/(\r\n|\r|\n)/gm," ")}),i.addEventListener("keydown",function(e){13===e.keyCode&&e.preventDefault()})};t--;)i()}}]),e}(),SeoField=function e(t,i){classCallCheck(this,e),this.snippetFields={title:null,slug:null,desc:null},this.options={hasPreview:!1,isNew:!1},this.options=i,new Tabs(t),new Snippet(t,this),new Social(t,this),this.options.hasPreview&&new FocusKeywords(t,this)};window.SeoField=SeoField;
//# sourceMappingURL=SeoField.min.js.map