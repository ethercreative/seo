var SeoField=function(e,t){if(window.hasSeoField)return SeoField.Fail("One SEO field only"),void document.getElementById(e+"-field").classList.add("seo--disabled");var o=this;window.hasSeoField=!0,this.namespace=e,this.title(),this.slug(),this.desc(),t&&(this.getHTMLForParsing=new SeoField.GetEntryHTML,this.keyword=document.getElementById(e+"-keyword"),this.score=document.getElementById(e+"-score"),this.list=document.getElementById(e+"-list"),this.bar=document.getElementById(e+"-bar"),this.scoreField=document.getElementById(e+"-score-field"),this.toggle(),this.calculateScore(),setInterval(function(){o.calculateScore()},1e3))};SeoField.prototype.title=function(){var e,t,o=this.titleField=document.getElementById(this.namespace+"-title"),s=document.getElementById("title"),i=this;if(e=function(){o.value=this.value+" "+n},t=function(){this.classList.remove("clean"),s.removeEventListener("input",e,!1),this.removeEventListener("input",t,!1)},s&&o.classList.contains("clean")){var n=o.value;s.addEventListener("input",e,!1)}o.addEventListener("input",t,!1),o.addEventListener("change",function(){i.calculateScore()})},SeoField.prototype.slug=function(){var e=this.slugField=document.getElementById(this.namespace+"-slug"),t=document.getElementById("slug"),o=this;t&&e&&(e.textContent=t.value,setInterval(function(){e.textContent!==t.value&&(e.textContent=t.value,o.calculateScore())},1e3))},SeoField.prototype.desc=function(){function e(){setTimeout(function(){t.oninput()},1)}var t=this.descField=document.getElementById(this.namespace+"-description"),o=this;e(),document.getElementById("tabs")&&[].slice.call(document.querySelectorAll("#tabs a.tab")).forEach(function(t){t.addEventListener("click",function(){e()})}),Craft.livePreview&&(Craft.livePreview.on("enter",e),Craft.livePreview.on("exit",e)),window.addEventListener("resize",e),t.addEventListener("keydown",function(e){13===e.keyCode&&e.preventDefault()}),t.addEventListener("input",function(){this.value=this.value.replace(/(\r\n|\n|\r)/gm," "),this.value.length>160?this.classList.add("invalid"):this.classList.remove("invalid")}),t.addEventListener("change",function(){o.calculateScore()})},SeoField.prototype.toggle=function(){var e=this,t=!1;this.score.getElementsByClassName("toggle-score")[0].addEventListener("click",function(){e.score.classList.toggle("open"),t=!t,t?e.score.getElementsByClassName("details")[0].style.height=e.score.getElementsByClassName("details-inner")[0].clientHeight+"px":e.score.getElementsByClassName("details")[0].style.height=""}),this.toggle.close=function(){e.score.classList.remove("open"),t=!1,e.score.getElementsByClassName("details")[0].style.height=""}},SeoField.prototype.calculateScore=function(){if(this.keyword&&this.keyword.value){this.currentScore={};var e=this;this.currentScore.titleLength=this.judgeTitleLength(),this.currentScore.titleKeyword=this.judgeTitleKeyword(),this.currentScore.slug=this.judgeSlug(),this.currentScore.desc=this.judgeDesc(),this.getHTMLForParsing.update(function(t){""===t.textContent.replace("\r","").replace("\n","").replace("\r\n","").replace(/\s+/gi,"")?e.currentScore.noContent={score:SeoField.Levels.BAD,reason:"You have no content, adding some would be a good start!"}:(e.content=t,e.content.textOnly=e.content.textContent.replace("\r"," ").replace("\n"," ").replace("\r\n"," ").replace(/\s+/gi," "),e.content.stats=SeoField.TextStatistics(e.content.textContent),e.currentScore.wordCount=e.judgeWordCount(),e.currentScore.firstParagraph=e.judgeFirstParagraph(),e.currentScore.images=e.judgeImages(),e.currentScore.links=e.judgeLinks(),e.currentScore.headings=e.judgeHeadings(),e.currentScore.density=e.judgeDensity(),e.currentScore.fleschEase=e.judgeFleschEase()),e.getHTMLForParsing.clean(),e.updateScoreHtml()})}else this.toggle.close(),this.score.classList.add("disabled"),this.scoreField.value=""},SeoField.prototype.updateScoreHtml=function(){this.score.classList.remove("disabled");var e=SeoField.sortScore(this.currentScore),t=e.merged;this.list.innerHTML="";for(var o=0;o<t.length;o++){var s=t[o];this.list.innerHTML+='<li class="'+s.score+'">'+s.reason+"</li>"}var i=this.bar.getElementsByClassName("good")[0],n=this.bar.getElementsByClassName("ok")[0],r=this.bar.getElementsByClassName("bad")[0],a=1-(t.length-e.good.length)/t.length,l=1-(t.length-e.ok.length)/t.length,d=1-(t.length-e.bad.length)/t.length;i.style.transform="scale("+a+", 1)",n.style.transform="translateX("+100*a+"%) scale("+l+", 1)",r.style.transform="translateX("+100*(a+l)+"%) scale("+d+", 1)";var c="";c=d>a?"bad":d+l>a?"ok":"good",this.scoreField.value=c},SeoField.prototype.judgeTitleLength=function(){var e,t=this.titleField.value;return e={score:t.length<40||t.length>60?SeoField.Levels.BAD:SeoField.Levels.GOOD,reason:t.length<40?SeoField.Reasons.titleLengthFailMin:t.length>60?SeoField.Reasons.titleLengthFailMax:SeoField.Reasons.titleLengthSuccess},e.reason=e.reason.replace("{l}",t.length),e},SeoField.prototype.judgeTitleKeyword=function(){var e;if(this.titleField.value.toLowerCase().indexOf(this.keyword.value.toLowerCase())>-1){for(var t=this.titleField.value.toLowerCase().split(" "),o=!1,s=0;s<t.length/2;s++)if(t[s]==this.keyword.value.toLowerCase()){o=!0;break}e=o?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.titleKeywordSuccess}:{score:SeoField.Levels.OK,reason:SeoField.Reasons.titleKeywordPosFail}}else e={score:SeoField.Levels.BAD,reason:SeoField.Reasons.titleKeywordFail};return e},SeoField.prototype.judgeSlug=function(){return this.slugField?this.slugField.textContent.toLowerCase().indexOf(this.keyword.value.toLowerCase())>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.slugSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.slugFail}:void 0},SeoField.prototype.judgeDesc=function(){return this.descField.value.toLowerCase().indexOf(this.keyword.value.toLowerCase())>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.descSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.descFail}},SeoField.prototype.judgeWordCount=function(){var e=this.content.stats.wordCount();return e>300?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.wordCountSuccess.replace("{l}",e)}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.wordCountFail.replace("{l}",e)}},SeoField.prototype.judgeFirstParagraph=function(){return this.content.querySelector("p")&&this.content.querySelector("p").textContent.toLowerCase().indexOf(this.keyword.value.toLowerCase())>-1?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.firstParagraphSuccess}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.firstParagraphFail}},SeoField.prototype.judgeImages=function(){var e=this.content.getElementsByTagName("img");if(e){for(var t=0,o=0;o<e.length;o++)e[o].getAttribute("alt")&&e[o].getAttribute("alt").toLowerCase().indexOf(this.keyword.value.toLowerCase())&&t++;return t===e.length?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.imagesSuccess}:t>=e.length/2?{score:SeoField.Levels.OK,reason:SeoField.Reasons.imagesOk}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.imagesFail}}},SeoField.prototype.judgeLinks=function(){var e=this.content.getElementsByTagName("a");if(e)for(var t=0;t<e.length;t++)if(SeoField.isExternalUrl(e[t].href))return{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.linksSuccess};return{score:SeoField.Levels.BAD,reason:SeoField.Reasons.linksFail}},SeoField.prototype.judgeHeadings=function(){var e=this.content.querySelectorAll("h1,h2,h3,h4,h5,h6");if(e){for(var t=0,o=0,s=0;s<e.length;s++)e[s].textContent.toLowerCase().indexOf(this.keyword.value.toLowerCase())>-1&&(["H1","H2"].indexOf(e[s].nodeName)>-1?t++:o++);if(t>0)return{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.headingsSuccess};if(o>0)return{score:SeoField.Levels.OK,reason:SeoField.Reasons.headingsOk}}return{score:SeoField.Levels.BAD,reason:SeoField.Reasons.headingsFail}},SeoField.prototype.judgeDensity=function(){function e(e,t){for(var o=0,s=0;s<e.length;s++)e[s].toLowerCase()==t&&o++;return o}var t=this.content.stats.words(),o=e(t,this.keyword.value.toLowerCase()),s=parseFloat((100+(o-t.length)/t.length*100).toFixed(2));return 1>s?{score:SeoField.Levels.BAD,reason:SeoField.Reasons.densityFailUnder.replace("{d}",s)}:2.5>=s?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.densitySuccess.replace("{d}",s)}:s>2.5?{score:SeoField.Levels.OK,reason:SeoField.Reasons.densityOk.replace("{d}",s).replace("{c}",o)}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.densityFail}},SeoField.prototype.judgeFleschEase=function(){var e=this.content.stats.fleschKincaidReadingEase();return e>=80?{score:SeoField.Levels.GOOD,reason:SeoField.Reasons.fleschSuccess.replace("{l}",e)}:e>=60?{score:SeoField.Levels.OK,reason:SeoField.Reasons.fleschOk.replace("{l}",e)}:{score:SeoField.Levels.BAD,reason:SeoField.Reasons.fleschFail.replace("{l}",e)}},SeoField.Fail=function(e){Craft.cp.displayError("<strong>SEO:</strong> "+e),window.console&&console.error.apply(console,["%cSEO: %c"+e,"font-weight:bold;","font-weight:normal;"])},SeoField.GetEntryHTML=function(){this.clean()},SeoField.GetEntryHTML.prototype.update=function(e){var t=this,o=Garnish.getPostData(document.getElementById("container"));this.lastPostData&&Craft.compare(o,this.lastPostData)||(this.lastPostData=o,$.ajax({url:Craft.livePreview.previewUrl,method:"POST",data:$.extend({},o,Craft.livePreview.basePostData),xhrFields:{withCredentials:!0},crossDomain:!0,success:function(o){o=o.replace(/<script([^'"]|"(\\.|[^"\\])*"|'(\\.|[^'\\])*')*?<\/script>/g,""),t.iframe.contentWindow.document.open(),t.iframe.contentWindow.document.write(o),t.iframe.contentWindow.document.close(),t.iframe.contentWindow.document.body?e(t.iframe.contentWindow.document.body):SeoField.Fail("Unable to calculate score")}}))},SeoField.GetEntryHTML.prototype.clean=function(){this.iframe&&document.body.removeChild(this.iframe),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("frameborder","0"),this.iframe.style.width="0px",this.iframe.style.height="0px",document.body.appendChild(this.iframe)},SeoField.isExternalUrl=function(){var e=/https?:\/\/((?:[\w\d]+\.)+[\w\d]{2,})/i,t=null;return function(o){function s(o){return null!==(t=e.exec(o))?t[1]:!1}return s(location.href)!==s(o)}}(),SeoField.sortScore=function(e){var t=[],o=[],s=[];for(var i in e)if(e.hasOwnProperty(i)&&e[i])switch(e[i].key=i,e[i].score){case SeoField.Levels.BAD:s.push(e[i]);break;case SeoField.Levels.OK:o.push(e[i]);break;case SeoField.Levels.GOOD:t.push(e[i])}return{good:t,ok:o,bad:s,merged:t.concat(o.concat(s))}},function(e){function t(e){var t=["li","p","h1","h2","h3","h4","h5","h6","dd"];return t.forEach(function(t){e=e.replace("</"+t+">",".")}),e=e.replace(/<[^>]+>/g,"").replace(/[,:;()\-]/," ").replace(/â€™/g,"'").replace(/[\.!?]/,".").replace(/^\s+/,"").replace(/[ ]*(\n|\r\n|\r)[ ]*/," ").replace(/([\.])[\. ]+/,".").replace(/[ ]*([\.])/,". ").replace(/\s+/," ").replace(/\s+$/,""),e+="."}function o(e){return new s(e)}var s=function(e){this.text=e?t(e):this.text};s.prototype.fleschKincaidReadingEase=function(e){return e=e?t(e):this.text,Math.round(10*(206.835-1.015*this.averageWordsPerSentence(e)-84.6*this.averageSyllablesPerWord(e)))/10},s.prototype.fleschKincaidGradeLevel=function(e){return e=e?t(e):this.text,Math.round(10*(.39*this.averageWordsPerSentence(e)+11.8*this.averageSyllablesPerWord(e)-15.59))/10},s.prototype.gunningFogScore=function(e){return e=e?t(e):this.text,Math.round(.4*(this.averageWordsPerSentence(e)+this.percentageWordsWithThreeSyllables(e,!1))*10)/10},s.prototype.colemanLiauIndex=function(e){return e=e?t(e):this.text,Math.round(10*(5.89*(this.letterCount(e)/this.wordCount(e))-.3*(this.sentenceCount(e)/this.wordCount(e))-15.8))/10},s.prototype.smogIndex=function(e){return e=e?t(e):this.text,Math.round(1.043*Math.sqrt(this.wordsWithThreeSyllables(e)*(30/this.sentenceCount(e))+3.1291)*10)/10},s.prototype.automatedReadabilityIndex=function(e){return e=e?t(e):this.text,Math.round(10*(4.71*(this.letterCount(e)/this.wordCount(e))+.5*(this.wordCount(e)/this.sentenceCount(e))-21.43))/10},s.prototype.textLength=function(e){return e=e?t(e):this.text,e.length},s.prototype.letterCount=function(e){return e=e?t(e):this.text,e=e.replace(/[^a-z]+/gi,""),e.length},s.prototype.sentenceCount=function(e){return e=e?t(e):this.text,e.replace(/[^\.!?]/g,"").length||1},s.prototype.wordCount=function(e){return e=e?t(e):this.text,e.split(/[^a-z0-9']+/i).length||1},s.prototype.words=function(){return this._words?this._words:this._words=this.text.split(/[^a-z0-9']+/i)},s.prototype.averageWordsPerSentence=function(e){return e=e?t(e):this.text,this.wordCount(e)/this.sentenceCount(e)},s.prototype.averageSyllablesPerWord=function(e){e=e?t(e):this.text;var o=0,s=this.wordCount(e),i=this;return e.split(/\s+/).forEach(function(e){o+=i.syllableCount(e)}),(o||1)/(s||1)},s.prototype.wordsWithThreeSyllables=function(e,o){e=e?t(e):this.text;var s=0,i=this;return o=o===!1?!1:!0,e.split(/\s+/).forEach(function(e){(!e.match(/^[A-Z]/)||o)&&i.syllableCount(e)>2&&s++}),s},s.prototype.percentageWordsWithThreeSyllables=function(e,o){return e=e?t(e):this.text,this.wordsWithThreeSyllables(e,o)/this.wordCount(e)*100},s.prototype.syllableCount=function(e){var t=0,o=0,s=0;e=e.toLowerCase().replace(/[^a-z]/g,"");var i={simile:3,forever:3,shoreline:2};if(i.hasOwnProperty(e))return i[e];var n=[/cial/,/tia/,/cius/,/cious/,/giu/,/ion/,/iou/,/sia$/,/[^aeiuoyt]{2,}ed$/,/.ely$/,/[cg]h?e[rsd]?$/,/rved?$/,/[aeiouy][dt]es?$/,/[aeiouy][^aeiouydt]e[rsd]?$/,/^[dr]e[aeiou][^aeiou]+$/,/[aeiouy]rse$/],r=[/ia/,/riet/,/dien/,/iu/,/io/,/ii/,/[aeiouym]bl$/,/[aeiou]{3}/,/^mc/,/ism$/,/([^aeiouy])\1l$/,/[^l]lien/,/^coa[dglx]./,/[^gq]ua[^auieo]/,/dnt$/,/uity$/,/ie(r|st)$/],a=[/^un/,/^fore/,/ly$/,/less$/,/ful$/,/ers?$/,/ings?$/];return a.forEach(function(t){e.match(t)&&(e=e.replace(t,""),o++)}),s=e.split(/[^aeiouy]+/gi).filter(function(e){return!!e.replace(/\s+/gi,"").length}).length,t=s+o,n.forEach(function(o){e.match(o)&&t--}),r.forEach(function(o){e.match(o)&&t++}),t||1},"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof define?define("textstatistics",[],function(){return o}):e.TextStatistics=o}(SeoField),SeoField.Levels={NONE:"",GOOD:"good",OK:"ok",BAD:"bad"},SeoField.Reasons={titleLengthFailMin:"The title contains {l} characters which is less than the recommended minimum of 40 characters.",titleLengthFailMax:"The title contains {l} characters which is greater than the recommended maximum of 60 characters.",titleLengthSuccess:"The title is between the recommended minimum and maximum length.",titleKeywordFail:"The title does not contain the keyword. Try adding it near the beginning of the title.",titleKeywordSuccess:"The title contains the keyword near the beginning.",titleKeywordPosFail:"The title contains the keyword, but not near the beginning. Try to move it closer to the start of the title.",slugFail:"The URL does not contain the keyword. Try adding it to the slug.",slugSuccess:"The URL contains the keyword.",descFail:"The description does not contain the keyword. Try adding it near the beginning of the description.",descSuccess:"The description contains the keyword.",wordCountFail:"Your text contains {l} words, this is less than the recommended 300 word minimum.",wordCountSuccess:"Your text contains {l} words, this is more than the recommended 300 word minimum.",firstParagraphFail:"The keyword does not appear in the first paragraph of your text. Try adding it.",firstParagraphSuccess:"The keyword appears in the first paragraph of your text.",imagesFail:"Less than half of the images have alt tags containing the keyword, try adding it to more images.",imagesOk:"Half or more of the images have alt tags containing the keyword. To improve this, try adding keywords to all the images alt tags.",imagesSuccess:"All of the images have alt tags containing the keyword.",linksFail:"The page does not contain any outgoing links. Try adding some.",linksSuccess:"The page contains outgoing links.",headingsFail:"The page does not contain any headings that contain the keyword. Try adding some with the keyword.",headingsOk:"The page contains some lower importance headings that contain the keyword. Try adding the keyword to some h2's.",headingsSuccess:"The page contains higher importance headings with the keyword.",densityFail:"The keyword does not appear in the text. It is important to include it in your content.",densityFailUnder:"The keyword density is {d}%, which is well under the advised 2.5%. Try increasing the number of times the keyword is used.",densityOk:"The keyword density is {d}%, which is over the advised 2.5%. The keyword appears {c} times.",densitySuccess:"The keyword density is {d}%, which is near the advised 2.5%.",fleschFail:"The Flesch Reading ease score is {l} which is considered best for university graduates. Try reducing your sentence length to improve readability.",fleschOk:"The Flesch Reading ease score is {l} which is average, and considered easily readable by most users.",fleschSuccess:"The Flesch Reading ease score is {l} meaning your content is readable by all ages."};